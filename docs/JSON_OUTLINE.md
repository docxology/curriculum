# JSON Outline Format

Complete reference for the JSON outline format used by the educational course Generator.

## Overview

The system uses **dynamically-generated JSON outlines** as the single source of truth for course structure. JSON outlines are created by the LLM during Stage 03 and consumed by Stages 04 and 05 for content generation.

**Key Concept**: Modules are NOT statically defined in `course_config.yaml`. Instead, the LLM generates a structured JSON outline based on high-level course parameters.

## Quick Reference

| Aspect | Details |
|--------|---------|
| **Generated By** | Stage 03 (`scripts/03_generate_outline.py`) |
| **Used By** | Stage 04 (primary materials), Stage 05 (secondary materials) |
| **Location** | `output/{course_name}/outlines/course_outline_TIMESTAMP.json` (or `output/outlines/` if no course template) |
| **Format** | JSON with `course_metadata` + `modules` array |
| **Alongside** | Markdown version (`.md`) for human readability |

## File Structure

### Complete JSON Schema

```json
{
  "course_metadata": {
    "name": "string",
    "description": "string",
    "level": "string",
    "duration_weeks": integer,
    "total_sessions": integer,
    "total_modules": integer,
    "generated": "ISO-8601 timestamp"
  },
  "modules": [
    {
      "module_id": integer,
      "module_name": "string",
      "sessions": [
        {
          "session_number": integer,
          "session_title": "string",
          "subtopics": ["string", ...],
          "learning_objectives": ["string", ...],
          "key_concepts": ["string", ...],
          "rationale": "string"
        }
      ]
    }
  ]
}
```

### Example Outline

```json
{
  "course_metadata": {
    "name": "Introductory Biology",
    "description": "Comprehensive educational course covering molecular to ecological perspectives",
    "level": "Undergraduate Introductory",
    "duration_weeks": 16,
    "total_sessions": 15,
    "total_modules": 5,
    "generated": "2024-12-09T12:00:00Z"
  },
  "modules": [
    {
      "module_id": 1,
      "module_name": "Molecular and Cellular Foundations",
      "sessions": [
        {
          "session_number": 1,
          "session_title": "Chemical Basis of Life",
          "subtopics": [
            "Chemical basis of life",
            "Water properties and biological molecules",
            "Macromolecule structure and function"
          ],
          "learning_objectives": [
            "Explain the chemical basis of biological processes",
            "Describe the properties of water relevant to life",
            "Compare and contrast the four major macromolecule classes"
          ],
          "key_concepts": [
            "Biochemistry fundamentals",
            "Organic chemistry in biology",
            "Molecular interactions"
          ],
          "rationale": "This session provides the foundation for understanding biological processes at the molecular level"
        },
        {
          "session_number": 2,
          "session_title": "Cell Structure and Organization",
          "subtopics": [
            "Cell structure and organization",
            "Prokaryotic vs eukaryotic cells",
            "Organelle functions"
          ],
          "learning_objectives": [
            "Distinguish between prokaryotic and eukaryotic cells",
            "Identify major organelles and their functions",
            "Explain the endosymbiotic theory"
          ],
          "key_concepts": [
            "Cell theory",
            "Compartmentalization",
            "Cellular evolution"
          ],
          "rationale": "Understanding cell structure is essential for comprehending cellular function and organization"
        }
      ]
    }
  ]
}
```

## Field Definitions

### Course Metadata

**Required Fields**:
| Field | Type | Description | Source |
|-------|------|-------------|--------|
| `name` | string | Course title | `course_config.yaml` → `course.name` |
| `level` | string | Difficulty level | `course_config.yaml` → `course.level` |
| `duration_weeks` | integer | Course duration | `course_config.yaml` → `course.estimated_duration_weeks` (mapped to `duration_weeks` in JSON) |
| `total_sessions` | integer | Total class sessions | `course_config.yaml` → `course.defaults.total_sessions` |
| `total_modules` | integer | Number of modules | `course_config.yaml` → `course.defaults.num_modules` (mapped to `total_modules` in JSON) |

**Optional Fields**:
| Field | Type | Description | Source |
|-------|------|-------------|--------|
| `description` | string | Course description | `course_config.yaml` → `course.description` |
| `generated` | string | Generation timestamp | Auto-generated (ISO-8601) |
| `course_template` | string | Course template name | Auto-added when using course templates from `config/courses/` |

### Module Fields

**Required Fields**:
| Field | Type | Description |
|-------|------|-------------|
| `module_id` | integer | Unique module identifier (1-based) |
| `module_name` | string | Module title (LLM-generated) |
| `sessions` | array | Array of session objects |

**Optional Fields**:
| Field | Type | Description |
|-------|------|-------------|
| `module_description` | string | Brief overview of module scope | LLM-generated, used for context in content generation |

### Session Fields

| Field | Type | Count | Description |
|-------|------|-------|-------------|
| `session_number` | integer | 1 | Session number (globally sequential, 1-based across all modules) |
| `session_title` | string | 1 | Descriptive title for the session |
| `subtopics` | array[string] | 3-7 | Specific topics covered in session |
| `learning_objectives` | array[string] | 3-7 | Learning outcomes for session |
| `key_concepts` | array[string] | 3-7 | Core concepts to master |
| `rationale` | string | 1 | Explanation of why this session is important |

**Item Counts**: Controlled by `llm_config.yaml` → `outline_generation.items_per_field`. Default: 3-7 items per field.

## Generation Process

### Stage 03: Outline Generation

```bash
uv run python3 scripts/03_generate_outline.py
```

**Process**:
1. Loads `course_config.yaml` (course metadata + defaults)
2. Loads `llm_config.yaml` (outline prompt template + item bounds)
3. LLM generates module structure based on:
   - `num_modules` (e.g., 5 modules)
   - `total_sessions` (e.g., 15 sessions)
   - `course_description` (guides topic selection)
   - `additional_constraints` (optional requirements or topic guidance)
4. Validates JSON structure
5. Saves two files:
   - `course_outline_TIMESTAMP.json` (machine-readable)
   - `course_outline_TIMESTAMP.md` (human-readable)

### Interactive vs Non-Interactive Modes

**Interactive Mode** (default):
- Prompts for `num_modules` and `total_sessions`
- Allows runtime override of config defaults
- Confirms before generation

**Non-Interactive Mode**:
```bash
uv run python3 scripts/03_generate_outline.py --non-interactive
```
- Uses config defaults only
- No prompts (CI/CD friendly)

## Consumption Process

### Stage 04: Primary Materials

```bash
uv run python3 scripts/04_generate_primary.py
```

**Process**:
1. Automatically discovers latest `course_outline_*.json`
2. Loads module and session structure
3. For each module → each session:
   - Generates lecture (session-specific content)
   - Generates lab (hands-on for session topics)
   - Generates study notes (session summary)
   - Generates diagrams (visual aids for session)
   - Generates questions (assessment for session)

**Output Structure**:
```
output/{course_name}/modules/module_01_molecular_and_cellular_foundations/
  session_01/
    lecture.md
    lab.md
    study_notes.md
    diagram_1.mmd
    diagram_2.mmd
    questions.md
  session_02/
    lecture.md
    lab.md
    ...
```

**Note**: `{course_name}` is the course template name (e.g., `biology`, `chemistry`). When using default config (no template), paths are `output/modules/...` (no course subdirectory).

### Stage 05: Secondary Materials

```bash
uv run python3 scripts/05_generate_secondary.py
```

**Process**:
1. Loads `course_outline_*.json`
2. Reads all primary materials from session folders
3. For each session, generates session-level secondary materials:
   - Application (real-world uses)
   - Extension (advanced topics)
   - Visualization (additional diagrams and concept maps)
   - Integration (cross-module connections)
   - Investigation (research questions)
   - Open Questions (current scientific debates)

**Output Structure**:
```
output/modules/module_01_molecular_and_cellular_foundations/
  session_01/          # From Stage 04 (primary materials)
    lecture.md
    lab.md
    study_notes.md
    diagram_1.mmd
    diagram_2.mmd
    questions.md
    # From Stage 05 (session-level secondary materials):
    application.md
    extension.md
    visualization.mmd
    integration.md
    investigation.md
    open_questions.md
  session_02/
    ...
```

## Discovery Mechanism

### Multi-Location Search

Scripts search multiple locations for outlines (most recent selected):

**Search Paths**:
1. `output/outlines/` (project root, config default)
2. `scripts/output/outlines/` (scripts directory)
3. Config-specified directory (`output_config.yaml` → `output.directories.outlines`)

**Selection Logic**:
- Find all `course_outline_*.json` files
- Sort by modification time
- Select most recent
- Log selected path

**Example Log**:
```
INFO - Searching for course outline JSON...
INFO - Found 3 outline files across all locations
INFO - Using most recent: output/outlines/course_outline_20241209_120000.json
```

### Explicit Path Override

```bash
# Override automatic discovery
uv run python3 scripts/04_generate_primary.py --outline custom/path/outline.json
uv run python3 scripts/05_generate_secondary.py --outline custom/path/outline.json
```

## Configuration Source

### course_config.yaml

```yaml
course:
  name: "Introductory Biology"
  description: "Comprehensive educational course..."
  level: "Undergraduate Introductory"
  estimated_duration_weeks: 16
  
  defaults:
    num_modules: 5           # How many modules to generate
    total_sessions: 15       # Total class sessions
    sessions_per_module: null  # Auto-calculated (15/5 = 3)
  
  additional_constraints: ""  # Optional: Additional requirements or topic guidance
```

**Key Points**:
- `num_modules` and `total_sessions` control outline generation
- `course_description` and `additional_constraints` guide topic selection
- LLM generates all topics based on course description and constraints
- LLM creates actual module structure and session distribution

### llm_config.yaml

```yaml
outline_generation:
  items_per_field:
    subtopics:
      min: 3
      max: 7
    learning_objectives:
      min: 3
      max: 7
    key_concepts:
      min: 3
      max: 7

prompts:
  outline:
    system: "You are an expert biology curriculum designer..."
    template: |
      Generate a course outline with {num_modules} modules...
      Total sessions: {total_sessions}
      Course description: {course_description}
      Constraints: {additional_constraints}
      
      Output valid JSON with this structure:
      {{
        "course_metadata": {{...}},
        "modules": [...]
      }}
```

## Validation Rules

### JSON Structure Validation

**Required Fields (course_metadata)**:
- `name` (non-empty string)
- `level` (non-empty string)
- `duration_weeks` (positive integer)
- `total_sessions` (positive integer)
- `total_modules` (positive integer)

**Required Fields (modules)**:
- `module_id` (1-based sequential integers)
- `module_name` (non-empty string)
- `sessions` (non-empty array)

**Required Fields (sessions)**:
- `session_number` (1-based sequential integers, globally across all modules)
- `session_title` (non-empty string)
- `subtopics` (array with 1+ items)
- `learning_objectives` (array with 1+ items)
- `key_concepts` (array with 1+ items)
- `rationale` (non-empty string)

### Automatic Normalization

**OutlineGenerator** performs automatic normalization:
- Ensures sequential `module_id` values
- Ensures sequential `session_number` values globally (1-N across all modules)
- Validates array field counts against config bounds
- Adds missing metadata fields with defaults
- Validates JSON schema compliance

## Migration from Static Modules

### Old Approach (Deprecated)

```yaml
# OLD: course_config.yaml with static modules
modules:
  - id: 1
    name: "Cell Biology"
    subtopics:
      - "Cell structure"
    learning_objectives:
      - "Understand cells"
```

### New Approach (Current)

```yaml
# NEW: course_config.yaml with dynamic generation
course:
  defaults:
    num_modules: 5
    total_sessions: 15
  additional_constraints: "Focus on cellular and molecular biology"
```

**Migration Steps**:
1. Remove static `modules` section from `course_config.yaml`
2. Set `num_modules` and `total_sessions` in `defaults`
3. Optionally add `additional_constraints` for topic guidance
4. Run Stage 03 to generate JSON outline
5. Review generated outline
6. Proceed with Stages 04 and 05

## Best Practices

### 1. Review Generated Outlines

```bash
# Generate outline
uv run python3 scripts/03_generate_outline.py

# Review JSON structure
cat output/outlines/course_outline_*.json | jq '.'

# Review human-readable version
cat output/outlines/course_outline_*.md
```

### 2. Validate Before Content Generation

```python
from src.config.loader import ConfigLoader

config = ConfigLoader("config")
outline_path = "output/outlines/course_outline_20241209.json"

# Load and validate
modules = config.load_outline_from_json(outline_path)
print(f"Loaded {len(modules)} modules")
```

### 3. Version Control Outlines

```bash
# Keep generated outlines in git (recommended)
git add output/outlines/course_outline_*.json
git commit -m "Add generated course outline for review"

# Or gitignore for fully automated workflows
echo "output/outlines/*.json" >> .gitignore
```

### 4. Iterate on Outline Generation

```bash
# Generate multiple outlines
for i in {1..3}; do
  uv run python3 scripts/03_generate_outline.py --non-interactive
done

# Review all generated outlines
ls -lt output/outlines/course_outline_*.json

# Compare outlines (module counts, session distribution)
for file in output/outlines/course_outline_*.json; do
  echo "=== $file ==="
  jq '{total_modules: .course_metadata.total_modules, total_sessions: .course_metadata.total_sessions, modules: [.modules[] | {id: .module_id, name: .module_name, sessions: (.sessions | length)}]}' "$file"
done

# Select best outline for content generation
uv run python3 scripts/04_generate_primary.py --outline output/outlines/course_outline_20241209_120000.json
```

## Practical Use Cases

### Use Case 1: Small Course (3 modules, 9 sessions)

**Goal**: Quick, focused biology fundamentals course

**Configuration** (`course_config.yaml`):
```yaml
course:
  name: "Biology Fundamentals"
  level: "High School"
  estimated_duration_weeks: 9
  defaults:
    num_modules: 3
    total_sessions: 9  # 3 sessions per module
  additional_constraints: "Focus on cell biology basics, genetics fundamentals, and ecology introduction"
```

**Generated Outline Structure**:
```json
{
  "course_metadata": {
    "total_modules": 3,
    "total_sessions": 9
  },
  "modules": [
    {"module_id": 1, "module_name": "Cell Biology Basics", "sessions": [...]},  // 3 sessions
    {"module_id": 2, "module_name": "Genetics Fundamentals", "sessions": [...]},  // 3 sessions
    {"module_id": 3, "module_name": "Ecology Introduction", "sessions": [...]}   // 3 sessions
  ]
}
```

**Generation Time**: ~1 hour (Stage 04), ~15 min (Stage 05)

---

### Use Case 2: Standard Course (5 modules, 15 sessions)

**Goal**: Comprehensive introductory biology

**Configuration**:
```yaml
course:
  name: "Introductory Biology"
  level: "Undergraduate Introductory"
  estimated_duration_weeks: 16
  defaults:
    num_modules: 5
    total_sessions: 15  # 3 sessions per module
  additional_constraints: "Cover molecular and cellular foundations, genetics and evolution, physiology and systems, ecology and biodiversity, and scientific methods"
```

**Generated Outline Structure**: 5 modules × 3 sessions each

**Generation Time**: ~2-3 hours (Stage 04), ~30 min (Stage 05)

---

### Use Case 3: Large Course (13 modules, 39 sessions)

**Goal**: Comprehensive year-long biology curriculum

**Configuration**:
```yaml
course:
  name: "Comprehensive Biology"
  level: "Undergraduate"
  estimated_duration_weeks: 30
  defaults:
    num_modules: 13
    total_sessions: 39  # 3 sessions per module
  additional_constraints: "Comprehensive coverage including biochemistry, molecular biology, cell structure, genetics, evolution, diversity, and all major biological systems"
```

**Generated Outline Structure**: 13 modules × 3 sessions each

**Generation Time**: ~4-5 hours (Stage 04), ~1 hour (Stage 05)

---

### Use Case 4: Uneven Session Distribution

**Goal**: Modules with varying session counts based on complexity

**Configuration** (using interactive mode):
```bash
# Run interactive outline generation
uv run python3 scripts/03_generate_outline.py

# When prompted:
# - num_modules: 5
# - total_sessions: 17

# LLM will distribute sessions unevenly, e.g.:
# Module 1: 4 sessions (complex topic)
# Module 2: 3 sessions (standard)
# Module 3: 4 sessions (complex topic)
# Module 4: 3 sessions (standard)
# Module 5: 3 sessions (standard)
```

**Result**: Flexible session allocation based on topic complexity

---

### Use Case 5: Research-Focused Advanced Course

**Goal**: Graduate-level course with deep content

**Configuration**:
```yaml
course:
  name: "Advanced Molecular Biology"
  level: "Graduate"
  estimated_duration_weeks: 16
  defaults:
    num_modules: 6
    total_sessions: 24  # 4 sessions per module
  additional_constraints: "Advanced topics including genomics, proteomics, protein engineering, systems biology, synthetic biology, bioinformatics, and current research frontiers"
```

**LLM Config** (`llm_config.yaml`):
```yaml
outline_generation:
  items_per_field:
    subtopics: {min: 5, max: 10}      # More detailed
    learning_objectives: {min: 5, max: 10}
    key_concepts: {min: 5, max: 10}
```

**Result**: Dense, detailed sessions with comprehensive coverage

## Troubleshooting

### "Outline not found"

**Problem**: Scripts can't find JSON outline

**Solution**:
```bash
# Check outline exists
ls -la output/outlines/course_outline_*.json

# If missing, generate outline
uv run python3 scripts/03_generate_outline.py

# Or use explicit path
uv run python3 scripts/04_generate_primary.py --outline path/to/outline.json
```

### "Invalid JSON structure"

**Problem**: LLM generated malformed JSON

**Solution**:
```bash
# Validate JSON syntax
cat output/outlines/course_outline_*.json | jq '.'

# Check for required fields
cat output/outlines/course_outline_*.json | jq '.course_metadata'

# Regenerate outline
uv run python3 scripts/03_generate_outline.py
```

### "Module count mismatch"

**Problem**: Generated modules don't match requested count

**Solution**:
```bash
# Check actual vs requested
jq '.course_metadata.total_modules, (.modules | length)' output/outlines/course_outline_*.json

# Adjust prompt template in llm_config.yaml
# Regenerate outline
uv run python3 scripts/03_generate_outline.py
```

## Related Documentation

- **[CONFIGURATION.md](CONFIGURATION.md)** - `course_config.yaml` and `llm_config.yaml` settings
- **[PIPELINE_GUIDE.md](PIPELINE_GUIDE.md)** - Stage 03, 04, 05 workflows
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - Outline generation and discovery mechanisms
- **[API.md](API.md)** - `ConfigLoader.load_outline_from_json()` API

## Summary

**JSON outlines are the bridge between configuration and content**:
1. **Input**: Course parameters in `course_config.yaml`
2. **Generation**: LLM creates structured JSON outline (Stage 03)
3. **Consumption**: Scripts read JSON for content generation (Stages 04-05)
4. **Output**: Comprehensive course materials organized by module and session

**Key Advantage**: Flexible, LLM-driven course structure that adapts to any topic or complexity level.

